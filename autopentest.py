# autopentest.py
import nmap
import argparse
import sys

def scan_ports(host):
    """
    Escanea los puertos más comunes (1-1024) en un host específico.
    """
    try:
        nm = nmap.PortScanner()
        print(f"[INFO] Escaneando {host}...")
        # Escanea los puertos TCP más comunes. 
        # Para un escaneo más rápido de puertos conocidos: '21,22,23,25,53,80,443'
        nm.scan(host, '1-1024')
        
        if host not in nm.all_hosts():
            print(f"[ERROR] Host {host} no parece estar activo.")
            return

        print(f"--- Resultados para {host} ---")
        for proto in nm[host].all_protocols():
            print(f"Protocolo: {proto}")
            
            ports = nm[host][proto].keys()
            for port in sorted(ports):
                state = nm[host][proto][port]['state']
                service = nm[host][proto][port]['name']
                print(f"  Puerto: {port}\tEstado: {state}\tServicio: {service}")
        print("------------------------------")

    except nmap.PortScannerError:
        print("[ERROR] Nmap no está instalado o no se encuentra en el PATH del sistema.")
        sys.exit(1)
    except Exception as e:
        print(f"[ERROR] Ocurrió un error inesperado: {e}")
        sys.exit(1)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="AutoPentest: Escáner de puertos básico.")
    parser.add_argument("host", help="La dirección IP o hostname a escanear (ej: 127.0.0.1)")
    args = parser.parse_args()
    
    scan_ports(args.host)
